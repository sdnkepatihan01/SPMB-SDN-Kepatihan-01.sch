<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>SPMB SDN Kepatihan 01 - Tahun Ajaran 2025/2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <style>
        /* CSS styles tetap sama seperti sebelumnya */
        /* ... (salin semua bagian CSS dari file sebelumnya) ... */
    </style>
</head>
<body>
    <!-- HTML structure tetap sama seperti sebelumnya -->
    <!-- ... (salin semua bagian HTML dari file sebelumnya) ... -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Fungsi untuk mengambil data dari Google Sheets
        async function fetchGraduationData() {
            // GANTI DENGAN DETAIL SHEET ANDA
            const sheetId = '1DhSdMg3TqqK_RnShG4Kjdj1TmoaaxqcEO-hyJxodN38'; // Ganti dengan ID Sheet Anda
            const sheetName = 'Sheet1'; // Ganti dengan nama sheet yang sesuai
            const apiKey = 'AIzaSyBg3xOQr3xY4QkH3-9JjWY5Z5v5Z5v5Z5v'; // Ganti dengan API key Anda
            
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`
                );
                const data = await response.json();
                
                if (data.values && data.values.length > 1) {
                    const headers = data.values[0];
                    return data.values.slice(1).map(row => {
                        const obj = {};
                        headers.forEach((header, i) => {
                            obj[header] = row[i] || '';
                        });
                        return obj;
                    });
                }
                return [];
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Gagal mengambil data dari server. Silakan coba lagi nanti.');
                return [];
            }
        }

        // Fungsi untuk membuka tab
        function openTab(tabName) {
            const tabPanes = document.getElementsByClassName('tab-pane');
            for (let i = 0; i < tabPanes.length; i++) {
                tabPanes[i].classList.remove('active');
            }
            document.getElementById(tabName).classList.add('active');
            
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') === `openTab('${tabName}')`) {
                    link.classList.add('active');
                }
            });
            
            window.scrollTo(0, 0);
            
            if (tabName === 'beranda') {
                document.getElementById('typing-text').innerHTML = '';
                i = 0;
                setTimeout(typeWriter, 500);
            }
        }

        // Fungsi Confetti
        function launchConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#FFD700', '#DC143C', '#FFFFFF'],
                shapes: ['circle', 'square', 'triangle'],
                scalar: 1.5
            });
        }

        // Fungsi Typing Effect
        const typingText = document.getElementById('typing-text');
        const text = "SISTEM PENERIMAAN MURID BARU";
        let i = 0;

        function typeWriter() {
            if (i < text.length) {
                typingText.innerHTML += text.charAt(i);
                i++;
                setTimeout(typeWriter, 100);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('printDate').textContent = new Date().toLocaleString();
            
            // Cek kelulusan berdasarkan NIK
            document.getElementById('btnCekKelulusan').addEventListener('click', async function() {
                const nik = document.getElementById('inputNik').value.trim();
                const resultDisplay = document.getElementById('resultDisplay');
                const statusBadge = document.getElementById('statusBadge');
                const jadwalDaftarUlang = document.getElementById('jadwalDaftarUlang');
                
                if (!nik) {
                    alert('Masukkan NIK siswa');
                    return;
                }
                
                if (nik.length !== 16 || !/^\d+$/.test(nik)) {
                    alert('NIK harus terdiri dari 16 digit angka');
                    return;
                }

                const btn = this;
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Memeriksa...';
                
                try {
                    const graduationData = await fetchGraduationData();
                    console.log('Data dari Google Sheets:', graduationData); // Untuk debugging
                    
                    const result = graduationData.find(item => item.NIK && item.NIK.toString().trim() === nik);
                    
                    if (result) {
                        document.getElementById('resultNoPendaftaran').textContent = result["NO PENDAFTARAN"] || '-';
                        document.getElementById('resultNama').textContent = result["NAMA SISWA"] || '-';
                        document.getElementById('resultTtl').textContent = result["TEMPAT TANGGAL LAHIR"] || '-';
                        document.getElementById('resultNik').textContent = result.NIK || '-';
                        
                        const status = result.STATUS;
                        statusBadge.textContent = status;
                        
                        if (status === "DITERIMA") {
                            statusBadge.className = "status-badge status-accepted";
                            jadwalDaftarUlang.style.display = 'block';
                            launchConfetti();
                        } else {
                            statusBadge.className = "status-badge status-rejected";
                            jadwalDaftarUlang.style.display = 'none';
                        }
                        
                        resultDisplay.style.display = 'block';
                        resultDisplay.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        alert('Data tidak ditemukan. Pastikan NIK yang dimasukkan benar dan sudah terdaftar.');
                        resultDisplay.style.display = 'none';
                        jadwalDaftarUlang.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Terjadi kesalahan saat memeriksa data. Silakan coba lagi.');
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-search me-2"></i> Check Data';
                }
            });
            
            // Fungsi untuk download hasil sebagai PDF
            document.getElementById('downloadBtn').addEventListener('click', function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const noPendaftaran = document.getElementById('resultNoPendaftaran').textContent;
                const nama = document.getElementById('resultNama').textContent;
                const ttl = document.getElementById('resultTtl').textContent;
                const nik = document.getElementById('resultNik').textContent;
                const status = document.getElementById('statusBadge').textContent;
                
                const logoUrl = 'logosekolah.png';
                
                doc.addImage(logoUrl, 'PNG', 15, 10, 30, 30);
                doc.setFontSize(16);
                doc.setTextColor(40);
                doc.text('SDN KEPATIHAN 01', 50, 20);
                doc.setFontSize(12);
                doc.text('PENGUMUMAN PENERIMAAN MURID BARU', 50, 28);
                doc.text('TAHUN AJARAN 2025/2026', 50, 35);
                
                doc.setDrawColor(200);
                doc.line(15, 40, 195, 40);
                
                doc.setFontSize(14);
                doc.setTextColor(50);
                doc.text('HASIL SELEKSI PENERIMAAN MURID BARU', 105, 50, null, null, 'center');
                
                doc.setFontSize(12);
                doc.text('Nomor Pendaftaran:', 20, 70);
                doc.text(noPendaftaran, 60, 70);
                
                doc.text('Nama Siswa:', 20, 80);
                doc.text(nama, 60, 80);
                
                doc.text('Tempat/Tgl Lahir:', 20, 90);
                doc.text(ttl, 60, 90);
                
                doc.text('NIK:', 20, 100);
                doc.text(nik, 60, 100);
                
                doc.setFontSize(14);
                doc.text('STATUS:', 20, 120);
                
                if (status === "DITERIMA") {
                    doc.setTextColor(0, 128, 0);
                    doc.text('DITERIMA', 50, 120);
                    doc.text('Selamat! Anda diterima di SDN Kepatihan 01', 105, 130, null, null, 'center');
                } else {
                    doc.setTextColor(255, 0, 0);
                    doc.text('TIDAK DITERIMA', 50, 120);
                    doc.text('Terima kasih telah mendaftar di SDN Kepatihan 01', 105, 130, null, null, 'center');
                }
                
                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text('Dokumen ini dicetak secara otomatis pada ' + new Date().toLocaleString(), 105, 220, null, null, 'center');
                doc.text('@2025 SISTEM PENERIMAAN MURID BARU SDN KEPATIHAN 01', 105, 225, null, null, 'center');
                
                doc.save('Pengumuman_Penerimaan_' + nama.replace(/\s/g, '_') + '.pdf');
            });
            
            // Back to Top Button
            const backToTopBtn = document.getElementById("backToTopBtn");
            window.onscroll = function() {
                backToTopBtn.style.display = window.scrollY > 300 ? "block" : "none";
            };
            backToTopBtn.onclick = function() {
                window.scrollTo({ top: 0, behavior: "smooth" });
            };

            // Dark Mode
            const toggle = document.getElementById("darkModeToggle");
            toggle.addEventListener("change", function() {
                document.body.classList.toggle("dark-mode", toggle.checked);
            });

            setTimeout(typeWriter, 1000);
        });
    </script>
    <!-- Tombol Back to Top -->
    <button id="backToTopBtn" title="Kembali ke Atas"><i class="fas fa-arrow-up"></i></button>
    <!-- Toggle Dark Mode -->
    <div class="form-check form-switch position-fixed bottom-0 end-0 m-4 z-3">
        <input class="form-check-input" id="darkModeToggle" type="checkbox"/>
        <label class="form-check-label text-dark" for="darkModeToggle">Dark Mode</label>
    </div>
</body>
</html>
